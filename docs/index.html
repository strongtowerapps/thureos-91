<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thureos-91 Lab | Strong Tower Apps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; }
        .font-cinzel { font-family: 'Cinzel', serif; }
        .shield-border { border-color: #634832; }
        .shield-text { color: #a88a6d; }
        .shield-bg { background-color: #634832; }
        .deep-blue-bg { background-color: #0f172a; }
        .status-container { min-height: 120px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="font-cinzel text-4xl md:text-6xl shield-text mb-2 tracking-widest">THUREOS-91</h1>
            <p class="text-slate-500 italic font-light">"The Shield of Your Data | Security Protocol by Strong Tower Apps"</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <section class="deep-blue-bg p-6 rounded-xl border-l-4 shield-border shadow-2xl">
                <h2 class="font-cinzel text-xl mb-4 shield-text flex items-center">
                    <span class="mr-2">‚öíÔ∏è</span> FORGE (Input)
                </h2>
                
                <div class="space-y-4">
                    <div class="flex gap-4 mb-4">
                        <button onclick="setMode('encode')" id="btnEncode" class="flex-1 py-2 rounded font-bold transition-all shield-bg text-stone-100 shadow-lg">ENCODE</button>
                        <button onclick="setMode('decode')" id="btnDecode" class="flex-1 py-2 rounded font-bold transition-all bg-slate-800 text-slate-500">DECODE</button>
                    </div>

                    <div id="versionContainer">
                        <label class="block text-xs uppercase tracking-widest mb-1 text-slate-500">Protocol Version</label>
                        <select id="versionSelect" class="w-full bg-slate-950 border border-slate-800 rounded p-3 mb-4 focus:outline-none focus:ring-2 focus:ring-[#634832] text-stone-200"><option value="v1.1">v1.1 (Salted + PBKDF2)</option><option value="v1.0">v1.0 (Legacy)</option></select>
                    </div>

                    <div>
                        <label class="block text-xs uppercase tracking-widest mb-1 text-slate-500">Data / Shielded String</label>
                        <textarea id="inputText" rows="5" class="w-full bg-slate-950 border border-slate-800 rounded p-3 focus:outline-none focus:ring-2 focus:ring-[#634832] text-stone-200" placeholder="Enter text or Thureos code..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-xs uppercase tracking-widest mb-1 text-slate-500">Security Key (Password)</label>
                        <input type="password" id="inputPass" class="w-full bg-slate-950 border border-slate-800 rounded p-3 focus:outline-none focus:ring-2 focus:ring-[#634832]" placeholder="8 characters minimum recommended">
                    </div>
                </div>
            </section>

            <section class="deep-blue-bg p-6 rounded-xl border-l-4 border-blue-900 shadow-2xl flex flex-col">
                <h2 class="font-cinzel text-xl mb-4 text-blue-400 flex items-center">
                    <span class="mr-2">üëÅÔ∏è</span> WATCHTOWER (Status)
                </h2>
                
                <div class="status-container flex-grow">
                    <div id="statusBox" class="w-full p-8 rounded bg-slate-950 border border-slate-900 text-center transition-all duration-300">
                        <span id="statusText" class="text-slate-600 italic text-lg uppercase tracking-widest">Awaiting data...</span>
                    </div>
                </div>
            </section>

            <section class="lg:col-span-2 deep-blue-bg p-6 rounded-xl border-t-4 shield-border shadow-2xl">
                <h2 class="font-cinzel text-xl mb-4 shield-text flex items-center">
                    <span class="mr-2">üõ°Ô∏è</span> RESULT
                </h2>
                <div class="relative">
                    <pre id="outputText" class="w-full bg-slate-950 border border-slate-900 rounded p-4 text-stone-300 break-all min-h-[100px] whitespace-pre-wrap font-mono text-sm"></pre>
                    <button onclick="copyOutput()" class="absolute top-2 right-2 shield-bg text-stone-100 px-4 py-1 rounded font-bold text-xs hover:opacity-90 transition-transform active:scale-95">COPY</button>
                </div>
            </section>
        </div>

        <footer class="mt-12 text-center text-slate-700 text-[10px] uppercase tracking-[0.2em]">
            Developed by Strong Tower Apps &copy; 2026
        </footer>
    </div>

    <script>
        const ALPHABET_V1_0 = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&()*+,-./:;<=>?@[]^_`{|}~;";
        const ALPHABET_V1_1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&()*+,-./:;<=>?@[]^_`{|}~abcdefghijklmnopqrstuvwxyz0123456789";
        const BASE = 91;
        let mode = 'encode';

        function setMode(newMode) {
            mode = newMode;
            document.getElementById('btnEncode').className = mode === 'encode' ? 'flex-1 py-2 rounded font-bold transition-all shield-bg text-stone-100 shadow-lg' : 'flex-1 py-2 rounded font-bold transition-all bg-slate-800 text-slate-500';
            document.getElementById('btnDecode').className = mode === 'decode' ? 'flex-1 py-2 rounded font-bold transition-all shield-bg text-stone-100 shadow-lg' : 'flex-1 py-2 rounded font-bold transition-all bg-slate-800 text-slate-500';
            
            document.getElementById('versionContainer').style.display = mode === 'encode' ? 'block' : 'none';
            update();
        }

        class Thureos91 {
            static _crc16(data) {
                let crc = 0xFFFF;
                for (let byte of data) {
                    crc ^= (byte << 8);
                    for (let i = 0; i < 8; i++) {
                        crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : (crc << 1);
                        crc &= 0xFFFF;
                    }
                }
                return crc & 0xFFFF;
            }

            static _toBase91(data, alphabet) {
                let queue = 0, nbits = 0, encoded = "";
                for (let i = 0; i < data.length; i++) {
                    queue |= (data[i] << nbits);
                    nbits += 8;
                    if (nbits > 13) {
                        let val = queue & 0x1FFF;
                        if (val > 88) { queue >>>= 13; nbits -= 13; } 
                        else { val = queue & 0x3FFF; queue >>>= 14; nbits -= 14; }
                        encoded += alphabet[val % BASE] + alphabet[Math.floor(val / BASE)];
                    }
                }
                if (nbits > 0) {
                    encoded += alphabet[queue % BASE];
                    if (nbits > 7 || queue >= BASE) encoded += alphabet[Math.floor(queue / BASE)];
                }
                return encoded;
            }

            static _fromBase91(string, alphabet) {
                let queue = 0, nbits = 0, val = -1;
                const bytes = [];
                for (let i = 0; i < string.length; i++) {
                    let c = alphabet.indexOf(string[i]);
                    if (val < 0) { val = c; } 
                    else {
                        val += c * BASE;
                        queue |= (val << nbits);
                        nbits += (val & 0x1FFF) > 88 ? 13 : 14;
                        do {
                            bytes.push(queue & 0xFF);
                            queue >>>= 8;
                            nbits -= 8;
                        } while (nbits > 7);
                        val = -1;
                    }
                }
                if (val >= 0) bytes.push((queue | (val << nbits)) & 0xFF);
                return new Uint8Array(bytes);
            }

            static async _deriveKey(password, salt) {
                const enc = new TextEncoder();
                const keyMaterial = await crypto.subtle.importKey("raw", enc.encode(password), { name: "PBKDF2" }, false, ["deriveBits"]);
                const keyBits = await crypto.subtle.deriveBits({ name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" }, keyMaterial, 256);
                return new Uint8Array(keyBits);
            }

            static _processLegacy(data, password, alphabet, mode) {
                const encoder = new TextEncoder();
                const passBytes = encoder.encode(password);
                if (mode === 'encode') {
                    const rawBytes = typeof data === 'string' ? encoder.encode(data) : data;
                    const crc = this._crc16(rawBytes);
                    const ciphered = rawBytes.map((b, i) => b ^ passBytes[i % passBytes.length]);
                    const encoded = this._toBase91(ciphered, alphabet);
                    const sig = alphabet[crc % BASE] + alphabet[Math.floor(crc / BASE) % BASE] + alphabet[Math.floor(crc / (BASE * BASE))];
                    return `${encoded}"${sig}`;
                } else {
                    const [encodedBody, sig] = data.split('"');
                    if (!sig) throw new Error("Signature not found");
                    const ciphered = this._fromBase91(encodedBody, alphabet);
                    const decrypted = ciphered.map((b, i) => b ^ passBytes[i % passBytes.length]);
                    const expectedCRC = alphabet.indexOf(sig[0]) + (alphabet.indexOf(sig[1]) * BASE) + (alphabet.indexOf(sig[2]) * BASE * BASE);
                    if (this._crc16(decrypted) !== expectedCRC) throw new Error("Integrity Error");
                    return decrypted;
                }
            }

            static _processVariableFlow(data, keyBytes, alphabet, mode) {
                if (mode === 'encode') {
                    const rawBytes = typeof data === 'string' ? new TextEncoder().encode(data) : data;
                    const crc = this._crc16(rawBytes);
                    const ciphered = rawBytes.map((b, i) => b ^ keyBytes[i % keyBytes.length]);
                    const encoded = this._toBase91(ciphered, alphabet);
                    const sig = alphabet[crc % BASE] + alphabet[Math.floor(crc / BASE) % BASE] + alphabet[Math.floor(crc / (BASE * BASE))];
                    return encoded + sig;
                } else {
                    const sig = data.slice(-3);
                    const encodedBody = data.slice(0, -3);
                    const ciphered = this._fromBase91(encodedBody, alphabet);
                    const decrypted = ciphered.map((b, i) => b ^ keyBytes[i % keyBytes.length]);
                    const expectedCRC = alphabet.indexOf(sig[0]) + (alphabet.indexOf(sig[1]) * BASE) + (alphabet.indexOf(sig[2]) * BASE * BASE);
                    if (this._crc16(decrypted) !== expectedCRC) throw new Error("Integrity Error");
                    return decrypted;
                }
            }

            static encode(data, password, version = 'v1.0') {
                if (version === 'v1.0') return this._processLegacy(data, password, ALPHABET_V1_0, 'encode');
                if (version === 'v1.1') {
                    const salt = crypto.getRandomValues(new Uint8Array(16));
                    return this._deriveKey(password, salt).then(key => {
                        const saltHeader = this._toBase91(salt, ALPHABET_V1_1);
                        const payload = this._processVariableFlow(data, key, ALPHABET_V1_1, 'encode');
                        return `${saltHeader}'${payload}`;
                    });
                }
                throw new Error(`Unsupported version '${version}'`);
            }

            static decode(shielded, password) {
                if (shielded.includes("'")) {
                    const [saltH, payload] = shielded.split("'");
                    const salt = this._fromBase91(saltH, ALPHABET_V1_1);
                    return this._deriveKey(password, salt).then(key => {
                        return this._processVariableFlow(payload, key, ALPHABET_V1_1, 'decode');
                    });
                }
                return this._processLegacy(shielded, password, ALPHABET_V1_0, 'decode');
            }
        }

        const input = document.getElementById('inputText');
        const pass = document.getElementById('inputPass');
        const verSelect = document.getElementById('versionSelect');
        const output = document.getElementById('outputText');
        const statusBox = document.getElementById('statusBox');
        const statusText = document.getElementById('statusText');

        async function update() {
            const val = input.value.trim();
            const p = pass.value;
            const ver = verSelect.value;

            if(!val || !p) {
                output.innerText = "...";
                statusBox.className = "w-full p-8 rounded bg-slate-950 border border-slate-900 text-center transition-all duration-300";
                statusText.innerText = "AWAITING FORGE...";
                statusText.className = "text-slate-600 italic text-lg uppercase tracking-widest";
                return;
            }

            try {
                if (mode === 'encode') {
                    const res = await Thureos91.encode(val, p, ver);
                    output.innerText = res;
                    statusBox.className = "w-full p-8 rounded bg-green-950/30 border border-green-700 text-center shadow-[0_0_15px_rgba(22,101,52,0.2)]";
                    statusText.innerText = `üõ°Ô∏è SHIELD GENERATED (${ver})`;
                    statusText.className = "text-green-500 font-bold text-lg uppercase tracking-widest";
                } else {
                    const decryptedBytes = await Thureos91.decode(val, p);
                    const res = new TextDecoder().decode(decryptedBytes);
                
                    output.innerText = res;
                    statusBox.className = "w-full p-8 rounded bg-blue-950/30 border border-blue-700 text-center shadow-[0_0_15px_rgba(30,58,138,0.2)]";
                    statusText.innerText = "‚úÖ ACCESS: INTEGRITY VERIFIED";
                    statusText.className = "text-blue-400 font-bold text-lg uppercase tracking-widest";
                }
            } catch (e) {
                output.innerText = "---";
                statusBox.className = "w-full p-8 rounded bg-red-950/30 border border-red-900 text-center";
                statusText.innerText = `‚ö†Ô∏è ERROR: ${e.message.toUpperCase()}`;
                statusText.className = "text-red-500 font-bold text-lg uppercase tracking-widest";
            }
        }

        input.addEventListener('input', update);
        pass.addEventListener('input', update);
        verSelect.addEventListener('change', update);

        function copyOutput() {
            if(output.innerText && output.innerText !== "...") {
                navigator.clipboard.writeText(output.innerText);
                const btn = event.target;
                btn.innerText = "COPIED!";
                setTimeout(() => btn.innerText = "COPY", 2000);
            }
        }
    </script>
</body>
</html>