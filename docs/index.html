<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thureos-91 Lab | Strong Tower Apps</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .font-cinzel { font-family: 'Cinzel', serif; }
        .gold-border { border-color: #fbbf24; }
        .gold-text { color: #fbbf24; }
        .gold-bg { background-color: #fbbf24; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="font-cinzel text-4xl md:text-6xl gold-text mb-2 tracking-widest">THUREOS-91</h1>
            <p class="text-slate-400 italic font-light">"The Shield of Your Data | High-Density Protocol by Strong Tower Apps"</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <section class="bg-slate-800 p-6 rounded-xl border-l-4 gold-border shadow-2xl">
                <h2 class="font-cinzel text-xl mb-4 gold-text flex items-center">
                    <span class="mr-2">‚öíÔ∏è</span> FORGE (Entrance)
                </h2>
                
                <div class="space-y-4">
                    <div class="flex gap-4 mb-4">
                        <button onclick="setMode('encode')" id="btnEncode" class="flex-1 py-2 rounded font-bold transition-all bg-amber-500 text-slate-900 shadow-lg">ENCODE</button>
                        <button onclick="setMode('decode')" id="btnDecode" class="flex-1 py-2 rounded font-bold transition-all bg-slate-700 text-slate-400">DECODE</button>
                    </div>

                    <div>
                        <label class="block text-xs uppercase tracking-widest mb-1 text-slate-500">Data / Shielded String</label>
                        <textarea id="inputText" rows="5" class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:outline-none focus:ring-2 focus:ring-yellow-500 text-yellow-50" placeholder="Ingresa texto o c√≥digo Thureos..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-xs uppercase tracking-widest mb-1 text-slate-500">Security Key (Password)</label>
                        <input type="password" id="inputPass" class="w-full bg-slate-900 border border-slate-700 rounded p-3 focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="M√≠nimo 8 caracteres recomendado">
                    </div>
                </div>
            </section>

            <section class="bg-slate-800 p-6 rounded-xl border-l-4 border-blue-500 shadow-2xl flex flex-col justify-between">
                <div>
                    <h2 class="font-cinzel text-xl mb-4 text-blue-400 flex items-center">
                        <span class="mr-2">üëÅÔ∏è</span> WATCHTOWER (State)
                    </h2>
                    <div id="statusBox" class="p-4 rounded bg-slate-900 border border-slate-700 text-center mb-4 transition-all duration-300">
                        <span id="statusText" class="text-slate-500 italic">Waiting for data...</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-900 p-3 rounded text-center border border-slate-700">
                        <span class="block text-[10px] text-slate-500 uppercase tracking-tighter">Thureos Efficiency</span>
                        <span id="t91Ratio" class="text-xl font-bold gold-text">0%</span>
                    </div>
                    <div class="bg-slate-900 p-3 rounded text-center border border-slate-700">
                        <span class="block text-[10px] text-slate-500 uppercase tracking-tighter">Base64 Reference</span>
                        <span id="b64Ratio" class="text-xl font-bold text-slate-400">0%</span>
                    </div>
                </div>
            </section>

            <section class="lg:col-span-2 bg-slate-800 p-6 rounded-xl border-t-4 gold-border shadow-2xl">
                <h2 class="font-cinzel text-xl mb-4 gold-text flex items-center">
                    <span class="mr-2">üõ°Ô∏è</span> RESULT
                </h2>
                <div class="relative">
                    <pre id="outputText" class="w-full bg-slate-900 border border-slate-700 rounded p-4 text-yellow-100 break-all min-h-[80px] whitespace-pre-wrap font-mono text-sm"></pre>
                    <button onclick="copyOutput()" class="absolute top-2 right-2 gold-bg text-slate-900 px-3 py-1 rounded font-bold text-xs hover:bg-yellow-400 transition-transform active:scale-95">COPY</button>
                </div>
            </section>
        </div>

        <footer class="mt-12 text-center text-slate-600 text-[10px] uppercase tracking-[0.2em]">
            Developed by Strong Tower Apps &copy; 2026
        </footer>
    </div>

    <script>
        const ALPHABET = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&()*+,-./:;<=>?@[]^_`{|}~;";
        const BASE = 91;
        let mode = 'encode';

        function setMode(newMode) {
            mode = newMode;
            document.getElementById('btnEncode').className = mode === 'encode' ? 'flex-1 py-2 rounded font-bold transition-all bg-amber-500 text-slate-900 shadow-lg' : 'flex-1 py-2 rounded font-bold transition-all bg-slate-700 text-slate-400';
            document.getElementById('btnDecode').className = mode === 'decode' ? 'flex-1 py-2 rounded font-bold transition-all bg-amber-500 text-slate-900 shadow-lg' : 'flex-1 py-2 rounded font-bold transition-all bg-slate-700 text-slate-400';
            update();
        }

        class Thureos91 {
            static _crc16(data) {
                let crc = 0xFFFF;
                for (let byte of data) {
                    crc ^= (byte << 8);
                    for (let i = 0; i < 8; i++) {
                        crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : (crc << 1);
                        crc &= 0xFFFF;
                    }
                }
                return crc & 0xFFFF;
            }

            static encode(text, password) {
                const raw = new TextEncoder().encode(text);
                const pass = new TextEncoder().encode(password);
                const crc = this._crc16(raw);
                const ciphered = raw.map((b, i) => b ^ pass[i % pass.length]);

                let queue = 0, nbits = 0, encoded = "";
                for (let i = 0; i < ciphered.length; i++) {
                    queue |= (ciphered[i] << nbits);
                    nbits += 8;
                    if (nbits > 13) {
                        let val = queue & 0x1FFF;
                        if (val > 88) { queue >>>= 13; nbits -= 13; } 
                        else { val = queue & 0x3FFF; queue >>>= 14; nbits -= 14; }
                        encoded += ALPHABET[val % BASE] + ALPHABET[Math.floor(val / BASE)];
                    }
                }
                if (nbits > 0) {
                    encoded += ALPHABET[queue % BASE];
                    if (nbits > 7 || queue >= BASE) encoded += ALPHABET[Math.floor(queue / BASE)];
                }
                const sig = ALPHABET[crc % BASE] + ALPHABET[Math.floor(crc / BASE) % BASE] + ALPHABET[Math.floor(crc / (BASE * BASE))];
                return `${encoded}"${sig}`;
            }

            static decode(vaultString, password) {
                const [data, sig] = vaultString.split('"');
                if (!sig) throw new Error("Signature not found");

                let queue = 0, nbits = 0, val = -1;
                const bytes = [];
                for (let i = 0; i < data.length; i++) {
                    let c = ALPHABET.indexOf(data[i]);
                    if (val < 0) { val = c; } 
                    else {
                        val += c * BASE;
                        queue |= (val << nbits);
                        nbits += (val & 0x1FFF) > 88 ? 13 : 14;
                        do {
                            bytes.push(queue & 0xFF);
                            queue >>>= 8;
                            nbits -= 8;
                        } while (nbits > 7);
                        val = -1;
                    }
                }
                if (val >= 0) bytes.push((queue | (val << nbits)) & 0xFF);
                
                const uint8 = new Uint8Array(bytes);
                const pass = new TextEncoder().encode(password);
                const decrypted = uint8.map((b, i) => b ^ pass[i % pass.length]);
                
                const expectedCRC = ALPHABET.indexOf(sig[0]) + (ALPHABET.indexOf(sig[1]) * BASE) + (ALPHABET.indexOf(sig[2]) * BASE * BASE);
                if (this._crc16(decrypted) !== expectedCRC) throw new Error("Integrity Error");

                return new TextDecoder().decode(decrypted);
            }
        }

        const input = document.getElementById('inputText');
        const pass = document.getElementById('inputPass');
        const output = document.getElementById('outputText');
        const statusBox = document.getElementById('statusBox');
        const statusText = document.getElementById('statusText');
        const t91Ratio = document.getElementById('t91Ratio');
        const b64Ratio = document.getElementById('b64Ratio');

        function update() {
            const val = input.value.trim();
            const p = pass.value;

            if(!val || !p) {
                output.innerText = "...";
                statusBox.className = "p-4 rounded bg-slate-900 border border-slate-700 text-center mb-4";
                statusText.innerText = "Waiting for the forge...";
                return;
            }

            try {
                if (mode === 'encode') {
                    const res = Thureos91.encode(val, p);
                    output.innerText = res;
                    const over = ((res.length / val.length) - 1) * 100;
                    t91Ratio.innerText = `+${Math.max(0, over).toFixed(1)}%`;
                    b64Ratio.innerText = `+${(((btoa(val).length / val.length) - 1) * 100).toFixed(1)}%`;
                    statusBox.className = "p-4 rounded bg-green-900/30 border border-green-500 text-green-400 text-center mb-4";
                    statusText.innerText = "üõ°Ô∏è Shield Generated Successfully";
                } else {
                    const res = Thureos91.decode(val, p);
                    output.innerText = res;
                    statusBox.className = "p-4 rounded bg-blue-900/30 border border-blue-500 text-blue-400 text-center mb-4";
                    statusText.innerText = "‚úÖ Access: Complete Data";
                }
            } catch (e) {
                output.innerText = "---";
                statusBox.className = "p-4 rounded bg-red-900/30 border border-red-500 text-red-400 text-center mb-4";
                statusText.innerText = `‚ö†Ô∏è ERROR: ${e.message.toUpperCase()}`;
            }
        }

        input.addEventListener('input', update);
        pass.addEventListener('input', update);

        function copyOutput() {
            if(output.innerText && output.innerText !== "...") {
                navigator.clipboard.writeText(output.innerText);
                const btn = event.target;
                btn.innerText = "COPIED!";
                setTimeout(() => btn.innerText = "COPY", 2000);
            }
        }
    </script>
</body>
</html>